<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Roots Tutor Academy</title>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        :root {
            --primary-green: #2E7D32;
            --dark-blue: #0D1B2A;
            --background-color: #F8F9FA;
            --card-bg: #FFFFFF;
            --text-color: #333333;
            --subtle-text: #6c757d;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background-color: var(--background-color); color: var(--text-color); line-height: 1.6; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 2rem; }
        h1, h2 { color: var(--dark-blue); text-align: center; margin-bottom: 2rem; }
        .admin-section { background-color: var(--card-bg); padding: 2rem; border-radius: 8px; box-shadow: var(--shadow); margin-bottom: 2rem; }
        form { display: grid; grid-template-columns: 1fr; gap: 1rem; }
        @media (min-width: 768px) { form { grid-template-columns: 1fr 1fr; } .form-full-width { grid-column: 1 / -1; } }
        label { font-weight: 600; margin-bottom: 0.5rem; display: block; }
        input, select, textarea { width: 100%; padding: 0.8rem; border: 1px solid #ccc; border-radius: 6px; font-size: 1rem; }
        button { grid-column: 1 / -1; background-color: var(--primary-green); color: white; padding: 1rem; font-size: 1.1rem; border: none; border-radius: 6px; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #1B5E20; }
        #message { text-align: center; margin-top: 1rem; font-weight: 600; }
        
        /* Table Styles for Tutor Requests */
        .requests-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        .requests-table th, .requests-table td { padding: 12px 15px; border: 1px solid #ddd; text-align: left; }
        .requests-table th { background-color: var(--dark-blue); color: white; }
        .requests-table tbody tr:nth-of-type(even) { background-color: var(--background-color); }
        .requests-table tbody tr:hover { background-color: #e9e9e9; }
        .table-container { overflow-x: auto; } /* For mobile responsiveness */
    </style>
</head>
<body>
    <div class="container">
        <h1>Roots Tutor Academy - Admin Panel</h1>

        <!-- Section for Tutor Requests -->
        <section class="admin-section">
            <h2><i class="fas fa-inbox"></i> Tutor Requests</h2>
            <div class="table-container">
                <table class="requests-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Parent Name</th>
                            <th>Contact</th>
                            <th>Class</th>
                            <th>Subjects</th>
                            <th>Area</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody id="requests-tbody">
                        <!-- Rows will be dynamically inserted here -->
                        <tr><td colspan="7" style="text-align: center;">Loading requests...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Forms for adding content -->
        <section class="admin-section">
            <h2><i class="fas fa-plus-circle"></i> Add New Content</h2>
            <form id="resource-form">
                <h3 class="form-full-width">Add a Learning Resource</h3>
                <input type="text" id="resource-title" placeholder="Resource Title" required>
                <input type="url" id="resource-link" placeholder="YouTube or PDF Link" required>
                <select id="resource-class" required>
                    <option value="">Select Class</option>
                    <option>Matric</option>
                    <option>FSc</option>
                    <option>O-Levels</option>
                </select>
                <select id="resource-subject" required>
                    <option value="">Select Subject</option>
                    <option>Physics</option>
                    <option>Chemistry</option>
                    <option>Math</option>
                </select>
                <select id="resource-type" required class="form-full-width">
                    <option value="">Select Type</option>
                    <option value="video">Video</option>
                    <option value="pdf">PDF</option>
                    <option value="notes">Notes</option>
                </select>
                <button type="submit">Add Resource</button>
            </form>
            <hr style="margin: 2rem 0; border: 1px solid #eee;">
            <form id="article-form">
                <h3 class="form-full-width">Add a News Article</h3>
                <input type="text" id="article-title" placeholder="Article Title" required class="form-full-width">
                <textarea id="article-excerpt" placeholder="Short excerpt..." required class="form-full-width"></textarea>
                <input type="url" id="article-imageUrl" placeholder="Image URL (e.g., from Placehold.co)" required>
                <select id="article-category" required>
                    <option value="">Select Category</option>
                    <option>News</option>
                    <option>Results</option>
                    <option>Blogs</option>
                </select>
                <button type="submit">Add Article</button>
            </form>
            <div id="message"></div>
        </section>
    </div>

    <!-- Firebase SDK and Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyChaU7FMhPkg-VI0lfctenjLKbaHUmBnZU",
            authDomain: "onnnnnnnn-86197.firebaseapp.com",
            projectId: "onnnnnnnn-86197",
            storageBucket: "onnnnnnnn-86197.appspot.com",
            messagingSenderId: "708226700407",
            appId: "1:708226700407:web:51b22d980cc650b1ba6272"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const messageDiv = document.getElementById('message');
        const resourceForm = document.getElementById('resource-form');
        const articleForm = document.getElementById('article-form');
        const requestsTbody = document.getElementById('requests-tbody');

        // --- Fetch and Display Tutor Requests ---
        const requestsQuery = query(collection(db, "tutorRequests"), orderBy("submittedAt", "desc"));
        onSnapshot(requestsQuery, (snapshot) => {
            requestsTbody.innerHTML = ''; // Clear existing rows
            if (snapshot.empty) {
                requestsTbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No tutor requests yet.</td></tr>';
                return;
            }
            snapshot.forEach(doc => {
                const request = doc.data();
                const row = document.createElement('tr');
                const submissionDate = request.submittedAt ? new Date(request.submittedAt.seconds * 1000).toLocaleDateString() : 'N/A';
                row.innerHTML = `
                    <td>${submissionDate}</td>
                    <td>${request.parentName}</td>
                    <td>${request.phone}</td>
                    <td>${request.studentClass}</td>
                    <td>${request.subjects.join(', ')}</td>
                    <td>${request.area}</td>
                    <td>${request.notes}</td>
                `;
                requestsTbody.appendChild(row);
            });
        });

        // --- Form Submission Logic ---
        function getYouTubeThumbnail(url) {
            if (!url) return 'https://placehold.co/600x400/2E7D32/FFFFFF?text=Resource';
            const videoId = url.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
            return videoId ? `https://img.youtube.com/vi/${videoId[1]}/hqdefault.jpg` : 'https://placehold.co/600x400/2E7D32/FFFFFF?text=Resource';
        }

        resourceForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const thumbnailUrl = getYouTubeThumbnail(document.getElementById('resource-link').value);
            try {
                await addDoc(collection(db, 'resources'), {
                    title: document.getElementById('resource-title').value,
                    link: document.getElementById('resource-link').value,
                    class: document.getElementById('resource-class').value,
                    subject: document.getElementById('resource-subject').value,
                    type: document.getElementById('resource-type').value,
                    thumbnailUrl: thumbnailUrl,
                    createdAt: serverTimestamp()
                });
                messageDiv.textContent = 'Resource added successfully!';
                messageDiv.style.color = 'green';
                resourceForm.reset();
            } catch (error) {
                console.error("Error adding resource: ", error);
                messageDiv.textContent = 'Error adding resource.';
                messageDiv.style.color = 'red';
            }
            setTimeout(() => messageDiv.textContent = '', 3000);
        });

        articleForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                await addDoc(collection(db, 'articles'), {
                    title: document.getElementById('article-title').value,
                    excerpt: document.getElementById('article-excerpt').value,
                    imageUrl: document.getElementById('article-imageUrl').value,
                    category: document.getElementById('article-category').value,
                    createdAt: serverTimestamp()
                });
                messageDiv.textContent = 'Article added successfully!';
                messageDiv.style.color = 'green';
                articleForm.reset();
            } catch (error) {
                console.error("Error adding article: ", error);
                messageDiv.textContent = 'Error adding article.';
                messageDiv.style.color = 'red';
            }
            setTimeout(() => messageDiv.textContent = '', 3000);
        });
    </script>
</body>
</html>

